# 企業情報自動収集システム要件定義書

## 文書情報
- 作成日：2024年11月21日
- 更新日：2025年06月14日
- バージョン：1.2
- 作成者：システム開発チーム

## 1. プロジェクト概要

### 1.1 システム名称
企業情報自動収集システム（Company Information Collection System）

### 1.2 目的
従業員が手作業で行っている企業情報の収集作業を自動化し、業務時間の削減と情報精度の向上を実現する。

### 1.3 背景と課題
- **現状**：従業員が週4-5時間をかけて手作業でWeb検索を行い、企業情報を収集している
- **課題**：
  - 作業時間が膨大（週4-5時間）
  - 異なる企業情報が混ざるリスク
  - 情報の網羅性・正確性の担保が困難
  - 支店情報の詳細（住所詳細、電話番号、営業時間）の収集が困難

### 1.4 プロジェクトのゴール
- 週4-5時間の作業時間を30分程度に削減（90%以上の削減）
- 企業情報の混在リスクをゼロに
- 営業リスト、顧客管理、BI分析の基盤データとして活用可能な高品質データの提供
- 支店情報の詳細な自動収集（住所詳細、電話番号、従業員数、営業時間）

## 2. 機能要件

### 2.1 企業情報収集機能
| 機能ID | 機能名 | 説明 | 優先度 | バージョン |
|--------|--------|------|--------|------------|
| F-001 | 企業情報一括取得 | スプレッドシートに記載された100-200社の企業名から本社情報を自動取得 | 高 | v1.0 |
| F-002 | 正式名称自動補正 | 略称や表記揺れを正式企業名に自動変換 | 高 | v1.0 |
| F-003 | 支店情報収集 | 本社情報に紐づく支店・営業所情報を自動収集 | 高 | v1.0 |
| F-003-1 | 支店住所詳細抽出 | 支店の完全な住所（番地・ビル名まで）を抽出 | 高 | v1.2 |
| F-003-2 | 支店電話番号抽出 | 各支店の個別電話番号を抽出 | 高 | v1.2 |
| F-003-3 | 支店従業員数・営業時間抽出 | 可能な場合は従業員数と営業時間を抽出 | 中 | v1.2 |
| F-004 | バッチ分割処理 | GAS実行時間制限（6分）を考慮し、8社ずつのバッチに分割して処理 | 高 | v1.0 |
| F-011 | 本社・支店判別機能 | 取得した情報が本社か支店かを自動判別し、適切なテーブルに振り分け | 高 | v1.0 |

### 2.2 データ品質管理機能
| 機能ID | 機能名 | 説明 | 優先度 | バージョン |
|--------|--------|------|--------|------------|
| F-005 | ユニークID生成 | 本社・支店データを結合するための一意のキーを自動生成 | 高 | v1.0 |
| F-010 | 信頼性スコア算出 | 取得情報の信頼度を数値化（情報源、新しさ、複数ソース確認） | 中 | v1.0 |
| F-016 | データ完全性チェック | 必須フィールドの欠損をチェックし、品質レポートを生成 | 中 | v1.2 |

### 2.3 システム管理機能
| 機能ID | 機能名 | 説明 | 優先度 | バージョン |
|--------|--------|------|--------|------------|
| F-006 | データ更新管理 | 既存データの上書き更新（月次更新対応） | 中 | v1.0 |
| F-007 | エラーログ記録 | 処理エラーの詳細をスプレッドシートに記録 | 高 | v1.0 |
| F-008 | エラー通知メール | エラー発生時に管理者へメール通知 | 中 | v1.0 |
| F-009 | 処理完了レポート | バッチ処理の実行結果をサマリー表示 | 中 | v1.0 |
| F-012 | スプレッドシート管理 | スプレッドシートの自動作成・ID管理・切り替え機能 | 中 | v1.0 |
| F-013 | スクリプトプロパティ管理 | APIキー、設定値をスクリプトプロパティで一元管理 | 高 | v1.0 |

## 3. データ仕様

### 3.1 本社情報テーブル
| フィールド名 | データ型 | 説明 | 必須 | バージョン |
|-------------|----------|------|------|------------|
| 企業ID | 文字列 | 一意識別子 | ○ | v1.0 |
| 企業名 | 文字列 | 正規化後企業名 | ○ | v1.0 |
| 正式企業名 | 文字列 | 登記上の正式名称 | ○ | v1.0 |
| 電話番号 | 文字列 | 本社代表電話番号 | △ | v1.0 |
| 業種大分類 | 文字列 | 業種の大分類 | △ | v1.0 |
| 業種中分類 | 文字列 | 業種の中分類 | △ | v1.0 |
| 従業員数 | 文字列 | 従業員数（単位含む） | △ | v1.0 |
| 設立年 | 文字列 | 設立年または設立日 | △ | v1.0 |
| 資本金 | 文字列 | 資本金（単位含む） | △ | v1.0 |
| 上場区分 | 文字列 | 上場市場名 | △ | v1.0 |
| 本社郵便番号 | 文字列 | 本社の郵便番号 | △ | v1.0 |
| 本社都道府県 | 文字列 | 本社の都道府県 | △ | v1.0 |
| 本社市区町村 | 文字列 | 本社の市区町村 | △ | v1.0 |
| 本社住所詳細 | 文字列 | 本社の詳細住所（番地・ビル名等） | △ | v1.0 |
| 代表者名 | 文字列 | 代表者の氏名 | △ | v1.0 |
| 代表者役職 | 文字列 | 代表者の役職 | △ | v1.0 |
| 企業理念 | 文字列 | 企業理念・ミッション | △ | v1.0 |
| 最新ニュース | 文字列 | 最新のニュース・発表 | △ | v1.0 |
| 採用状況 | 文字列 | 採用情報 | △ | v1.0 |
| 企業URL | 文字列 | 公式ウェブサイト | △ | v1.0 |
| 信頼性スコア | 数値 | 情報の信頼度（0-100） | ○ | v1.0 |
| 処理日時 | 日時 | 処理実行日時 | ○ | v1.0 |
| 処理結果 | 文字列 | 処理結果（成功/エラー） | ○ | v1.0 |
| エラー内容 | 文字列 | エラーの詳細 | △ | v1.0 |
| 情報ソースURL | 文字列 | 主要な情報取得元URL | △ | v1.0 |

### 3.2 支店情報テーブル
| フィールド名 | データ型 | 説明 | 必須 | バージョン |
|-------------|----------|------|------|------------|
| 企業ID | 文字列 | 本社との紐付けキー | ○ | v1.0 |
| 支店名 | 文字列 | 支店・営業所名 | ○ | v1.0 |
| 支店電話番号 | 文字列 | 支店の電話番号 | △ | v1.0 |
| 支店郵便番号 | 文字列 | 支店の郵便番号 | △ | v1.0 |
| 支店都道府県 | 文字列 | 支店の都道府県 | △ | v1.0 |
| 支店市区町村 | 文字列 | 支店の市区町村 | △ | v1.0 |
| 支店住所詳細 | 文字列 | 支店の詳細住所（番地・ビル名等） | △ | v1.2 |
| 支店種別 | 文字列 | 支社/支店/営業所/工場等 | ○ | v1.0 |
| 主要度ランク | 数値 | 重要度ランク（1-5） | ○ | v1.0 |
| 従業員数 | 文字列 | 支店の従業員数 | △ | v1.2 |
| 営業時間 | 文字列 | 営業時間 | △ | v1.2 |
| 備考 | 文字列 | その他情報 | △ | v1.0 |

## 4. AI抽出スキーマ

### 4.1 OpenAI抽出用JSONスキーマ（v1.2）
```json
{
  "基本情報": {
    "正式名称": "string",
    "英語名": "string or null",
    "設立日": "YYYY-MM-DD or null",
    "代表者": "string or null",
    "代表者役職": "string or null",
    "本社所在地": "string or null",
    "電話番号": "string or null",
    "ウェブサイト": "URL or null"
  },
  "事業内容": {
    "主要事業": "string",
    "事業分野": ["array of strings"],
    "主要製品サービス": ["array of strings"],
    "企業理念": "string or null",
    "ミッション": "string or null",
    "ビジョン": "string or null"
  },
  "財務情報": {
    "資本金": "string with unit or null",
    "売上高": "string with unit and year or null",
    "従業員数": "string with unit and date or null",
    "上場情報": {
      "上場有無": "boolean",
      "市場": "string or null",
      "証券コード": "string or null"
    }
  },
  "採用情報": {
    "新卒採用": "boolean or null",
    "中途採用": "boolean or null",
    "採用職種": ["array of strings or null"],
    "採用メッセージ": "string or null"
  },
  "最新情報": {
    "最新ニュース": ["array of objects with title and date or null"],
    "プレスリリース": ["array of objects with title and date or null"],
    "更新日": "YYYY-MM-DD or null"
  },
  "支店情報": {
    "支店一覧": [{
      "支店名": "string",
      "支店種別": "本社/支社/支店/営業所/工場/事業所/その他",
      "郵便番号": "string or null",
      "都道府県": "string or null",
      "市区町村": "string or null",
      "住所詳細": "string or null",
      "電話番号": "string or null",
      "従業員数": "string or null",
      "営業時間": "string or null"
    }]
  },
  "その他": {
    "主要取引先": ["array of strings or null"],
    "グループ会社": ["array of strings or null"],
    "受賞歴認証": ["array of strings or null"],
    "備考": "string or null"
  }
}
```

## 5. システム制約

### 5.1 技術的制約
- Google Apps Scriptの実行時間制限（6分/実行）
  - 1社あたり約40秒の処理時間
  - 1バッチあたり最大8社まで処理可能
  - 100社処理の場合：約13バッチ（約8時間30分）が必要
- APIレート制限への対応が必要
- スプレッドシートのセル数制限（10,000,000セル）

### 5.2 品質要件
- 支店名抽出精度：90%以上
- 住所詳細抽出精度：80%以上（番地・ビル名まで）
- 電話番号抽出精度：85%以上

### 5.3 コスト制約
- 月間APIコスト：約630円（200社処理時）
  - Tavily AI：約600円
  - OpenAI：約30円

## 6. 今後の改善予定

### 6.1 短期改善（v1.3）
- 支店情報の抽出精度向上
- エラーハンドリングの改善
- ユーザーインターフェースの改善

### 6.2 中期改善（v2.0）
- 財務情報の詳細抽出
- 競合分析機能
- リアルタイム更新機能

### 6.3 長期改善（v3.0）
- AI分析レポート自動生成
- 他システムとのAPI連携
- 予測分析機能

## 7. 変更履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| v1.0 | 2024-11-21 | 初版作成 |
| v1.1 | 2025-06-10 | 検索精度向上、信頼性スコア改善 |
| v1.2 | 2025-06-14 | 支店情報詳細抽出機能追加、OpenAIスキーマ改善 |