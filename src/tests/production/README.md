# 本番環境テスト

このディレクトリには本番環境で実際のAPI・データを使用してテストを行うためのファイルが含まれています。

## ファイル構成

### `ProductionTests.js`
本番環境テスト用の全ての関数を含むメインファイル。

#### 提供される関数

| 関数名 | 説明 | 実行時間目安 |
|--------|------|--------------|
| `checkApiConfiguration()` | API設定の確認 | 即座 |
| `testRealApiConnections()` | 実際のAPI接続テスト | 5-10秒 |
| `testSingleCompanyResearch()` | 単一企業の調査テスト | 10-30秒 |
| `testSmallBatchProcessing()` | 3-5社の小規模バッチテスト | 30-90秒 |
| `testRealSpreadsheetProcessing()` | スプレッドシート処理テスト | 30-60秒 |
| `runProductionTests()` | 全ての本番テストを順次実行 | 2-5分 |

## 使用方法

### 1. 個別テスト実行
```javascript
// 設定確認
checkApiConfiguration();

// API接続テスト
testRealApiConnections();

// 単一企業テスト
testSingleCompanyResearch();

// 小規模バッチテスト
testSmallBatchProcessing();

// スプレッドシート処理テスト
testRealSpreadsheetProcessing();
```

### 2. 包括テスト実行
```javascript
// 推奨：全ての本番テストを順次実行
runProductionTests();
```

## 注意事項

### API使用量
- **Tavily API**: 1日の検索回数制限に注意
- **OpenAI API**: トークン使用量とコスト管理
- テストは少数の企業から開始することを推奨

### 事前準備
1. **APIキー設定**: TAVILY_API_KEY, OPENAI_API_KEYが設定済みであること
2. **スプレッドシート設定**: SPREADSHEET_IDが設定済みであること
3. **企業データ**: 企業リストシートに実際の企業名が入力済みであること

### エラー対応
- ネットワークエラー時の再試行機能が組み込まれています
- API制限に達した時は適切なエラーメッセージが表示されます
- 不正なデータ入力時のエラーハンドリングが含まれています

### データ管理
- スプレッドシートへの正しいデータ保存機能
- 重複データの適切な処理
- 処理状況の詳細ログ出力

## 実行結果の例

```
🚀 本番環境テスト実行開始
================================

📋 Step 1: 設定確認
=== API設定確認 ===
Tavily APIキー: 設定済み ✅
OpenAI APIキー: 設定済み ✅
通知メール: user@example.com
バッチサイズ: 20
スプレッドシートID: 設定済み ✅

🔌 Step 2: API接続テスト
--- Tavily API接続テスト ---
Tavily結果: ✅ 成功
--- OpenAI API接続テスト ---
OpenAI結果: ✅ 成功
✅ 全API接続成功

🏢 Step 3: 単一企業テスト
調査対象: トヨタ自動車株式会社
調査開始...
✅ 調査成功！
企業名: トヨタ自動車株式会社
本社所在地: 愛知県豊田市
信頼性スコア: 95%
処理時間: 12340ms
取得フィールド数: 15

📦 Step 4: 小規模バッチテスト
バッチ処理対象: 3社
✅ バッチ処理完了
成功: 3社
失敗: 0社
処理時間: 45230ms
平均処理時間: 15077ms/社

📊 Step 5: スプレッドシート処理テスト
処理対象企業数: 10
テスト処理対象: 2社
✅ スプレッドシート処理テスト完了

🎯 本番環境テスト結果
================================
設定確認: ✅
API接続: ✅
単一企業調査: ✅
バッチ処理: ✅
スプレッドシート処理: ✅
総実行時間: 67890ms

🎉 全ての本番環境テストが成功しました！
本格的な運用を開始できます。
```

## トラブルシューティング

### よくある問題

1. **API接続エラー**
   - APIキーが正しく設定されているか確認
   - インターネット接続を確認
   - API制限に達していないか確認

2. **スプレッドシートエラー**
   - スプレッドシートIDが正しいか確認
   - 適切な権限があるか確認
   - シート構造が正しいか確認

3. **処理タイムアウト**
   - Google Apps Scriptの実行時間制限（6分）に注意
   - バッチサイズを小さくして再試行
   - ネットワーク状況を確認

### サポート
問題が解決しない場合は、実行ログを確認し、エラーメッセージの詳細を記録してください。 